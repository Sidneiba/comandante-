<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mam√£oChat - Cadastro e Acesso</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: sans-serif;
            background-color: #f0f0f0;
            color: #333;
            font-size: 1rem;
        }
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .door {
            width: 50%;
            height: 100%;
            background-color: #8B4513;
            position: absolute;
            transition: transform 2s ease;
        }
        .door-left { left: 0; transform-origin: left; }
        .door-right { right: 0; transform-origin: right; }
        .door-open .door-left { transform: translateX(-100%); }
        .door-open .door-right { transform: translateX(100%); }
        #cart-icon { font-size: 100px; color: gold; position: absolute; z-index: 1001; }
        .hidden { display: none; }
        #messages {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #fff;
            min-height: 200px;
            margin-bottom: 10px;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        .bot { color: #333; }
        .user { color: #007bff; }
        #chat-container { display: none; }
        #login-container {
            display: none; /* Come√ßa escondido at√© a anima√ß√£o acabar */
            border: 2px solid #333;
            padding: 20px;
            background-color: #fff;
            width: 300px;
            margin: 20px auto;
            text-align: center;
        }
        #login-container h2 { margin: 0 0 20px; }
        input {
            padding: 5px;
            width: 80%;
            margin: 5px 0;
            font-size: 1rem;
        }
        button {
            padding: 5px 10px;
            margin: 5px;
            font-size: 1rem;
            cursor: pointer;
        }
        #visitor-btn { background-color: #28a745; color: white; }
    </style>
</head>
<body>
    <div id="intro-screen" aria-hidden="true">
        <div class="door door-left" aria-hidden="true"></div>
        <div class="door door-right" aria-hidden="true"></div>
        <span id="cart-icon" aria-label="√çcone do carrinho" role="img">üõí</span>
    </div>
    <div id="login-container">
        <h2>Fa√ßa seu cadastro</h2>
        <input type="text" id="name-input" placeholder="Nome" aria-label="Nome">
        <input type="text" id="password-input" placeholder="Senha" aria-label="Senha">
        <div>
            <button id="client-btn" onclick="setUserType('client')">Cliente</button>
            <button id="store-btn" onclick="setUserType('store')">Lojista</button>
            <button id="visitor-btn" onclick="startAsVisitor()">Visitante</button>
        </div>
    </div>
    <div id="chat-container">
        <div id="messages" aria-live="polite"></div>
        <input type="text" id="chat-input" placeholder="Digite aqui..." aria-label="Campo de entrada de texto">
        <button onclick="sendMessage()" aria-label="Enviar mensagem">Enviar</button>
    </div>

    <script>
        const introScreen = document.getElementById("intro-screen");
        const cartIcon = document.getElementById("cart-icon");
        const loginContainer = document.getElementById("login-container");
        const chatContainer = document.getElementById("chat-container");
        const messagesDiv = document.getElementById("messages");
        const chatInput = document.getElementById("chat-input");
        const nameInput = document.getElementById("name-input");
        const passwordInput = document.getElementById("password-input");

        let userType = null;
        let state = "login";
        let username = "";

        const users = {
            clients: { "joao": "123", "maria": "456" },
            stores: { "loja1": "AB", "loja2": "CD" }
        };

        // Anima√ß√£o inicial simplificada
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Iniciando anima√ß√£o");
            introScreen.classList.add("door-open");
            cartIcon.textContent = "üëç";
            setTimeout(() => {
                console.log("Anima√ß√£o conclu√≠da");
                introScreen.style.display = "none"; // For√ßa esconder
                loginContainer.style.display = "block"; // For√ßa mostrar
            }, 2000);
        });

        function setUserType(type) {
            userType = type;
            passwordInput.placeholder = type === "client" ? "Senha (3 d√≠gitos)" : "Senha (2 letras)";
            passwordInput.maxLength = type === "client" ? 3 : 2;
            checkLogin();
        }

        function startAsVisitor() {
            console.log("Iniciando como visitante");
            userType = "visitor";
            username = "Visitante";
            startChat();
        }

        function checkLogin() {
            const name = nameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!name || !password || !userType) return;

            const userGroup = userType === "client" ? "clients" : "stores";
            const isClient = userType === "client";
            const passwordValid = isClient ? /^\d{3}$/.test(password) : /^[A-Za-z]{2}$/.test(password);

            if (!passwordValid) {
                alert(`Senha inv√°lida! ${isClient ? "Use 3 d√≠gitos." : "Use 2 letras."}`);
                return;
            }

            if (users[userGroup][name]) {
                if (users[userGroup][name] === password) {
                    username = name;
                    startChat();
                } else {
                    alert("Senha incorreta!");
                }
            } else {
                users[userGroup][name] = password;
                username = name;
                console.log(`Novo ${userType} cadastrado: ${name} - ${password}`);
                startChat();
            }
        }

        function startChat() {
            console.log("Chat iniciado para:", username);
            loginContainer.style.display = "none";
            chatContainer.style.display = "block";
            addMessage(`Bem-vindo ao Mam√£oChat, ${username}!\n${userType === "visitor" ? "Digite 'sair' pra voltar." : userType === "client" ? "Digite: g√°s, ofertas ou sair" : "Digite: estoque ou sair"}`, "bot");
        }

        function addMessage(text, sender) {
            console.log("Adicionando mensagem:", text);
            const message = document.createElement("div");
            message.classList.add(sender);
            message.textContent = text;
            messagesDiv.appendChild(message);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function sendMessage() {
            const text = chatInput.value.trim().toLowerCase();
            if (text) {
                addMessage(text, "user");
                processInput(text);
                chatInput.value = "";
            }
        }

        function processInput(input) {
            if (userType === "visitor") {
                if (input === "sair") {
                    chatContainer.style.display = "none";
                    loginContainer.style.display = "block";
                    nameInput.value = "";
                    passwordInput.value = "";
                    userType = null;
                } else {
                    addMessage("Como visitante, voc√™ s√≥ pode 'sair' por enquanto.", "bot");
                }
                return;
            }

            if (userType === "client" && state === "login") {
                if (input === "g√°s") {
                    addMessage("G√°s a R$150. Quantos voc√™ quer?", "bot");
                    state = "awaitingQuantity";
                } else if (input === "ofertas") {
                    addMessage("Ofertas:\n- Lim√£o: R$3/kg\n- Laranja: R$4/kg\nDigite o item.", "bot");
                } else if (input === "sair") {
                    addMessage("At√© logo!", "bot");
                    chatContainer.style.display = "none";
                    loginContainer.style.display = "block";
                    nameInput.value = "";
                    passwordInput.value = "";
                    userType = null;
                    state = "login";
                } else {
                    addMessage("Digite: g√°s, ofertas ou sair", "bot");
                }
            }

            if (userType === "store" && state === "login") {
                if (input === "estoque") {
                    addMessage("Estoque:\n- G√°s: R$150\n- Lim√£o: R$3/kg", "bot");
                } else if (input === "sair") {
                    addMessage("At√© logo!", "bot");
                    chatContainer.style.display = "none";
                    loginContainer.style.display = "block";
                    nameInput.value = "";
                    passwordInput.value = "";
                    userType = null;
                    state = "login";
                } else {
                    addMessage("Digite: estoque ou sair", "bot");
                }
            }
        }

        nameInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") passwordInput.focus();
        });
        passwordInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") checkLogin();
        });
        chatInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
        });
    </script>
</body>
</html>
